<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="page-title">Vessel Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="icon" href="/assets/favicon.ico" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <div id="updateBanner">
    <div style="display: flex; justify-content: center; align-items: center;">
      <div style="text-align: center;">
        <span id="dataStatus">Loading data...</span> | <span id="updateTime">--</span>
      </div>
    </div>
  </div>

  <!-- Floating Dark Mode Button -->
  <button id="darkModeToggle" class="floating-dark-mode-btn">ðŸŒ™ Dark Mode</button>
  <div class="container">
    <div class="info-logo-row">
      <img src="data/vessel/logo.png" alt="Vessel Logo" class="logo-side" />
      <div class="map-container" style="flex: 1; margin: 0;">
        <div id="mapTitle" class="panel-title" style="text-align: center; margin-bottom: 10px;">Loading location...</div>
        <div id="map"></div>
      </div>
    </div>

    <!-- LINKS -->
    <div style="margin: 20px;">
      <div class="button-row" style="justify-content: space-between; gap: 10px;">
        <a href="#" id="signalk-admin-link" target="_blank" class="action-btn signal-btn">Open SignalK*</a>
        <a href="#" id="signalk-freeboard-link" target="_blank" class="action-btn plotter-btn">Open Freeboard-SK*</a>
        <a href="#" id="signalk-anchor-alarm-link" target="_blank" class="action-btn anchor-btn">Anchor Alarm*</a>
        <a href="#" id="marinetraffic-link" target="_blank" class="action-btn ais-btn">MarineTraffic</a>
        <a href="#" id="myshiptracking-link" target="_blank" class="action-btn ais-btn">MyShipTracking</a>
      </div>
      <p class="wifi-note">*Only works on vessel WiFi</p>
    </div>

    <!-- NAVIGATION -->
    <div class="info-panel" id="navigation-panel" style="margin: 20px;">
      <div class="panel-title">Navigation</div>
      <div class="data-grid" id="navigation-grid"></div>
    </div>

    <!-- WIND -->
    <div class="info-panel" id="wind-panel" style="margin: 20px;">
      <div class="panel-title">Wind</div>
      <div class="data-grid" id="wind-grid"></div>
    </div>

    <!-- POWER -->
    <div class="info-panel" id="power-panel" style="margin: 20px;">
      <div class="panel-title">Power</div>
      <div class="data-grid" id="power-grid"></div>
    </div>

    <!-- VESSEL INFORMATION -->
    <div class="info-panel" id="vessel-panel" style="margin: 20px;">
      <div class="panel-title">Vessel Information</div>
      <div class="data-grid" id="vessel-grid"></div>
    </div>

    <!-- ENVIRONMENT -->
    <div class="info-panel" id="environment-panel" style="margin: 20px;">
      <div class="panel-title">Environment</div>
      <div class="data-grid" id="environment-grid"></div>
    </div>

    <!-- INTERNET -->
    <div class="info-panel" id="internet-panel" style="margin: 20px;">
      <div class="panel-title">Internet</div>
      <div class="data-grid" id="internet-grid"></div>
    </div>

    <!-- PROPULSION -->
    <div class="info-panel" id="propulsion-panel" style="margin: 20px;">
      <div class="panel-title">Propulsion</div>
      <div class="data-grid" id="propulsion-grid"></div>
    </div>

    <!-- TANKS -->
    <div class="info-panel" id="tanks-panel" style="margin: 20px;">
      <div class="panel-title">Tanks</div>
      <div class="data-grid" id="tanks-grid"></div>
    </div>

    <!-- NOW PLAYING SECTION -->
    <div class="info-panel" id="now-playing-panel" style="margin: 20px;">
      <div class="panel-title">ðŸŽµ Now Playing</div>
      <div id="now-playing-content" style="display: flex; align-items: center; gap: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
        <div style="flex: 1;">
          <div id="track-name" style="font-size: 1.2em; font-weight: bold; color: var(--text-primary); margin-bottom: 5px;">No track playing</div>
          <div id="artist-album" style="color: var(--text-secondary); font-size: 0.9em;">No artist information</div>
        </div>
        <div id="track-info" style="flex: 1; text-align: right;">
          <div id="playback-source" style="color: var(--text-secondary); font-size: 0.9em;">No source</div>
          <div id="track-number" style="color: var(--text-secondary); font-size: 0.8em;">Track -- of --</div>
        </div>
      </div>
    </div>

    <div class="info-panel" style="margin: 20px;">
      <div id="tideHeader" class="panel-title" style="padding-top: 10px; margin-bottom: 0;"></div>
      <canvas id="tideChart"></canvas>
    </div>

    <!-- WIND FORECAST SECTION -->
    <div class="info-panel" style="margin: 20px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <div id="windHeader" class="panel-title" style="flex: 1; margin-bottom: 0;">Wind Forecast at Current Location</div>
        <select id="forecast-model" style="padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em; cursor: pointer;">
          <option value="wttr">wttr.in</option>
          <option value="ecmwf">ECMWF</option>
        </select>
      </div>
      <div class="wind-forecast-grid" id="wind-forecast-grid">
        <div class="wind-forecast-item">
          <div class="wind-time">Loading...</div>
          <div class="wind-speed">--</div>
          <div class="wind-direction">--</div>
        </div>
      </div>
    </div>

    <!-- WAVE FORECAST SECTION -->
    <div class="info-panel" style="margin: 20px;">
      <div class="panel-title">Swell Forecast (Dominant) at Current Location</div>
      <div class="wave-forecast-grid" id="wave-forecast-grid">
        <div class="wave-forecast-item">
          <div class="wave-time">Loading...</div>
          <div class="wave-height">--</div>
          <div class="wave-period">--</div>
          <div class="wave-direction">--</div>
        </div>
      </div>
    </div>

    <!-- POLAR PERFORMANCE SECTION -->
    <div class="info-panel" style="margin: 20px;">
      <div class="panel-title">Polar Performance</div>
      <div class="polar-performance-grid" id="polar-performance-grid">
        <!-- Left Column: Performance Data -->
        <div style="display: flex; flex-direction: column; gap: 15px;">
          <!-- Current Performance -->
          <div style="background: var(--bg-quaternary); padding: 15px; border-radius: 8px;">
            <div style="font-weight: bold; margin-bottom: 10px; color: var(--text-primary);">Current Performance</div>
            <div id="polar-performance" style="font-size: 0.9em;">
              <div>Loading polar data...</div>
            </div>
          </div>
          <!-- VMG Analysis -->
          <div style="background: var(--bg-quaternary); padding: 15px; border-radius: 8px;">
            <div style="font-weight: bold; margin-bottom: 10px; color: var(--text-primary);">VMG Analysis</div>
            <div id="vmg-analysis" style="font-size: 0.9em;">
              <div>Calculating VMG...</div>
            </div>
          </div>
        </div>
        <!-- Right Column: Polar Chart -->
        <div style="background: var(--bg-quaternary); padding: 15px; border-radius: 8px;">
          <div style="font-weight: bold; margin-bottom: 10px; color: var(--text-primary);">Polar Chart</div>
          <div class="polar-chart-container" style="position: relative; height: 600px; width: 100%;">
            <canvas id="polarChart"></canvas>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <script src="assets/utils.js"></script>
  <script src="assets/app.js"></script>

  <div class="footer">
    Created by <a href="https://zackphillips.com" target="_blank">Zack Phillips</a>
  </div>
</body>
</html>
